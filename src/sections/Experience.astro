---
import { Image } from "astro:assets";
import {
  Code,
  Braces,
  Layout,
  Monitor,
  AppWindow,
  FileBraces,
  ChevronDown,
  MonitorSmartphone,
  type Icon as IconType,
} from "@lucide/astro";

type ExperienceRole = {
  title: string;
  period: string;
  employment?: string;
  positionIcon?: typeof IconType;
  bullets: string[];
  skills: string[];
};

type CompanyExperience = {
  company: string;
  roles: ExperienceRole[];
};

const defaultExperience: CompanyExperience = {
  company: "Globant",
  roles: [
    {
      title: "Senior Web UI Developer",
      period: "01.2024 — Present",
      employment: "Full-time",
      positionIcon: Code,
      bullets: [
        "Spearhead the architecture of the design system registry, ensuring 100% component reusability across 5 product lines.",
        "Mentor junior developers and conduct code reviews to maintain high standards for production-ready React applications.",
      ],
      skills: [
        "TypeScript",
        "Next.js",
        "Tailwind",
        "Figma",
        "React",
        "Supabase",
        "JavaScript",
      ],
    },
    {
      title: "Web UI Developer",
      period: "08.2022 — 12.2023",
      employment: "",
      positionIcon: Braces,
      bullets: [
        "Built UI features and reusable components with a focus on consistency and accessibility.",
        "Collaborated closely with design and product to ship iterative improvements across the UI.",
      ],
      skills: ["TypeScript", "Next.js", "Tailwind", "Figma"],
    },
    {
      title: "Junior Frontend Dev",
      period: "08.2022 — 12.2023",
      employment: "",
      positionIcon: FileBraces,
      bullets: [
        "Implemented responsive layouts and UI improvements while learning best practices for modern frontend development.",
        "Contributed to component maintenance and internal UI tooling.",
      ],
      skills: [
        "TypeScript",
        "Next.js",
        "Tailwind",
        "Figma",
        "React",
        "Supabase",
        "JavaScript",
        "HTML",
        "CSS",
        "Git",
      ],
    },
  ],
};

const freelanceExperiences: CompanyExperience = {
  company: "Freelance",
  roles: [
    {
      title: "Frontend Engineer",
      period: "10.2025 — 01.2026",
      employment: "Contract",
      positionIcon: Code,
      bullets: [
        "Developed the main interface for a fleet management dashboard, focusing on fast data loading and overall usability.",
        "Implemented a minimalist and industrial design, seamlessly connecting the frontend with a real-time database.",
      ],
      skills: ["React", "TypeScript", "Tailwind CSS", "Supabase"],
    },
    {
      title: "Web UI Specialist",
      period: "08.2025 — 09.2025",
      employment: "Freelance",
      positionIcon: Braces,
      bullets: [
        "Built a high-performance landing page with near-instant load times using static site generation.",
        "Ensured perfect Lighthouse scores (100/100) by applying best practices for asset optimization and SEO.",
      ],
      skills: ["Astro", "Tailwind CSS", "TypeScript", "Figma"],
    },
    {
      title: "React Developer",
      period: "05.2025 — 07.2025",
      employment: "Contract",
      positionIcon: FileBraces,
      bullets: [
        "Translated Figma designs into pixel-perfect, interactive components for an e-commerce checkout flow.",
        "Optimized global state management and significantly reduced unnecessary re-renders in the shopping cart module.",
      ],
      skills: ["Next.js", "React", "Tailwind CSS", "JavaScript"],
    },
    {
      title: "UI Developer",
      period: "02.2025 — 04.2025",
      employment: "Freelance",
      positionIcon: Code,
      bullets: [
        "Designed and coded responsive email templates, ensuring cross-client compatibility and rendering consistency.",
        "Collaborated on integrating the frontend with custom SDKs to streamline automated email delivery.",
      ],
      skills: ["HTML", "CSS", "JavaScript", "React"],
    },
    {
      title: "Frontend Web Developer",
      period: "11.2024 — 01.2025",
      employment: "Contract",
      positionIcon: Braces,
      bullets: [
        "Refactored legacy frontend code into a modern, highly scalable component-based architecture.",
        "Improved overall accessibility (a11y) standards and ensured a fully responsive experience across mobile devices.",
      ],
      skills: ["Next.js", "TypeScript", "Tailwind CSS", "Git"],
    },
  ],
};

const { experience = defaultExperience } = Astro.props as {
  experience?: CompanyExperience;
  freelanceExperiences?: CompanyExperience;
};
---

<section id="experience" class="w-full flex justify-center bg-white py-18">
  <div class="w-full flex flex-col items-center max-w-5xl px-4 gap-16">
    <h2 class="text-5xl font-bold text-slate-600">Experience</h2>

    <div class="flex flex-col gap-6 w-full font-mono">
      <div class="flex items-center gap-3">
        <Image
          src="/images/globant-logo.png"
          alt="Globant logo"
          class="rounded-full w-9 h-9"
          width={50}
          height={50}
        />

        <h3 class="text-2xl font-semibold text-slate-900">
          {experience.company}
        </h3>
      </div>

      <ol class="pl-8">
        {
          experience.roles.map((role, index) => {
            const PositionIcon = role.positionIcon || Code;
            const isLast = index === experience.roles.length - 1;
            const isFirst = index === 0;

            return (
              <li class="flex items-stretch gap-4">
                <div class="flex w-10 flex-col items-center">
                  <div class="grid size-9 place-items-center rounded-sm border-2 border-slate-200 bg-white text-slate-700">
                    <PositionIcon class="size-4 text-slate-400 stroke-3" />
                  </div>
                  <div
                    class:list={[
                      "w-px flex-1 bg-slate-200",
                      isLast && "opacity-0",
                    ]}
                  />
                </div>

                {/* --- MAIN CONTAINER --- */}
                <div class="flex w-full flex-col gap-2">
                  <div
                    class="group w-full"
                    data-state={isFirst ? "open" : "closed"}
                  >
                    <button
                      type="button"
                      class="flex header-summary w-full cursor-pointer items-start gap-6 mt-1 text-left outline-none"
                    >
                      <div class="min-w-0 flex-1">
                        <div class="flex justify-between items-center">
                          <div class="flex gap-2 items-center">
                            <p class="truncate text-xl font-semibold text-slate-500 transition-colors duration-300 group-data-[state=open]:text-black">
                              {role.title}
                            </p>
                            <p class="text-xs text-slate-400">
                              {role.employment ? `${role.employment} · ` : ""}
                              {role.period}
                            </p>
                          </div>
                          <div class="mt-1 shrink-0 text-slate-400 transition-transform duration-500 group-data-[state=open]:-scale-100">
                            <ChevronDown class="size-5" />
                          </div>
                        </div>

                        <div class="grid grid-rows-[1fr] transition-[grid-template-rows] duration-500 ease-out group-data-[state=open]:grid-rows-[0fr]">
                          <div class="overflow-hidden mask-[linear-gradient(to_bottom,transparent,#000_10px,#000_calc(100%-15px),transparent)]">
                            <div class="mt-2 flex flex-wrap gap-2 pb-4 transition-transform duration-400 ease-out group-data-[state=open]:-translate-y-8 sm:flex">
                              {role.skills.map((skill) => (
                                <span class="rounded-md border border-slate-200 bg-slate-50 px-2 py-1 text-[10px] tracking-wide text-slate-600">
                                  {skill.toUpperCase()}
                                </span>
                              ))}
                            </div>
                          </div>
                        </div>
                      </div>
                    </button>

                    <div class="grid grid-rows-[0fr] transition-[grid-template-rows] duration-500 ease-out group-data-[state=open]:grid-rows-[1fr]">
                      <div class="overflow-hidden mask-[linear-gradient(to_bottom,#000_calc(100%-20px),transparent)]">
                        <div class="mt-2 flex flex-col gap-4 pb-4 -translate-y-4 opacity-0 transition-all duration-500 ease-in-out group-data-[state=open]:translate-y-0 group-data-[state=open]:opacity-100 md:flex-row md:items-start md:justify-between md:gap-8">
                          <ul class="flex-5 space-y-2 text-slate-700">
                            {role.bullets.map((bullet) => (
                              <li class="flex gap-3 font-light">
                                <span class="mt-[7px] size-1.5 shrink-0 rounded-full bg-lime-400" />
                                <p>{bullet}</p>
                              </li>
                            ))}
                          </ul>

                          <div class="flex flex-3 flex-wrap gap-2 md:max-w-[45%] md:justify-end">
                            {role.skills.map((skill) => (
                              <span class="rounded-md border border-slate-200 bg-slate-50 px-2 py-1 text-[10px] tracking-wide text-slate-600">
                                {skill.toUpperCase()}
                              </span>
                            ))}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
            );
          })
        }
      </ol>
    </div>
    <div class="flex flex-col gap-6 w-full font-mono">
      <div class="flex items-center gap-3">
        <Image
          src="/images/upwork-logo.png"
          alt="Upwork logo"
          class="rounded-full w-9 h-9 object-cover"
          width={50}
          height={50}
        />

        <h3 class="text-2xl font-semibold text-slate-900">Freelance</h3>
      </div>
      <ol class="pl-8">
        {
          freelanceExperiences.roles.map((role, index) => {
            const PositionIcon = role.positionIcon || Code;
            const isFirst = index === 0;

            return (
              <li class="flex items-stretch gap-4">
                <div class="flex w-10 flex-col items-center">
                  <div class="grid size-9 place-items-center rounded-sm border-2 border-slate-200 bg-white text-slate-700">
                    <PositionIcon class="size-4 text-slate-400 stroke-3" />
                  </div>
                </div>

                {/* --- MAIN CONTAINER --- */}
                <div class="flex w-full flex-col gap-2">
                  <div
                    class="group w-full"
                    data-state={isFirst ? "open" : "closed"}
                  >
                    <button
                      type="button"
                      class="flex header-summary w-full cursor-pointer items-start gap-6 mt-1 text-left outline-none"
                    >
                      <div class="min-w-0 flex-1">
                        <div class="flex justify-between items-center">
                          <div class="flex gap-2 items-center">
                            <p class="truncate text-xl font-semibold text-slate-500 transition-colors duration-300 group-data-[state=open]:text-black">
                              {role.title}
                            </p>
                            <p class="text-xs text-slate-400">
                              {role.employment ? `${role.employment} · ` : ""}
                              {role.period}
                            </p>
                          </div>
                          <div class="mt-1 shrink-0 text-slate-400 transition-transform duration-500 group-data-[state=open]:-scale-100">
                            <ChevronDown class="size-5" />
                          </div>
                        </div>

                        <div class="grid grid-rows-[1fr] transition-[grid-template-rows] duration-500 ease-out group-data-[state=open]:grid-rows-[0fr]">
                          <div class="overflow-hidden mask-[linear-gradient(to_bottom,transparent,#000_10px,#000_calc(100%-15px),transparent)]">
                            <div class="mt-2 flex flex-wrap gap-2 pb-6 transition-transform duration-400 ease-out group-data-[state=open]:-translate-y-8 sm:flex">
                              {role.skills.map((skill) => (
                                <span class="rounded-md border border-slate-200 bg-slate-50 px-2 py-1 text-[10px] tracking-wide text-slate-600">
                                  {skill.toUpperCase()}
                                </span>
                              ))}
                            </div>
                          </div>
                        </div>
                      </div>
                    </button>

                    <div class="grid grid-rows-[0fr] transition-[grid-template-rows] duration-500 ease-out group-data-[state=open]:grid-rows-[1fr]">
                      <div class="overflow-hidden mask-[linear-gradient(to_bottom,#000_calc(100%-20px),transparent)]">
                        <div class="mt-2 flex flex-col gap-4 pb-4 -translate-y-4 opacity-0 transition-all duration-500 ease-in-out group-data-[state=open]:translate-y-0 group-data-[state=open]:opacity-100 md:flex-row md:items-start md:justify-between md:gap-8">
                          <ul class="flex-5 space-y-2 text-slate-700">
                            {role.bullets.map((bullet) => (
                              <li class="flex gap-3 font-light">
                                <span class="mt-[7px] size-1.5 shrink-0 rounded-full bg-lime-400" />
                                <p>{bullet}</p>
                              </li>
                            ))}
                          </ul>

                          <div class="flex flex-3 flex-wrap gap-2 md:max-w-[45%] md:justify-end">
                            {role.skills.map((skill) => (
                              <span class="rounded-md border border-slate-200 bg-slate-50 px-2 py-1 text-[10px] tracking-wide text-slate-600">
                                {skill.toUpperCase()}
                              </span>
                            ))}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
            );
          })
        }
      </ol>
    </div>
  </div>
</section>

<script>
  const buttons = document.querySelectorAll("button.header-summary");

  // Handle clicks on each button.
  buttons.forEach((button) => {
    button.addEventListener("click", (e) => {
      const target = e.currentTarget as HTMLElement;
      const el = target.closest(".group") as HTMLElement | null;

      if (!el) return;

      el.dataset.state = el.dataset.state === "closed" ? "open" : "closed";
    });
  });
</script>
